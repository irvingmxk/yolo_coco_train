# data_1029 数据集配置说明

## ✅ 配置完成状态

所有训练脚本已成功配置使用新数据集 `data_1029`！

## 📊 数据集信息

### 基本信息
- **数据路径**: `/workspace/yolo/data_1029`
- **总图片数**: 158张
- **训练集**: 127张 (80%)
- **验证集**: 31张 (20%)

### 检测类别
```
0: bubble
1: other
2: user
```

### 数据结构
```
data_1029/
├── images/              # 原始图片（158张）
├── labels/              # 原始标签（158个）
├── train/
│   ├── images/         # 训练图片（127张）
│   └── labels/         # 训练标签（127个）
├── val/
│   ├── images/         # 验证图片（31张）
│   └── labels/         # 验证标签（31个）
├── classes.txt         # 类别文件
└── data.yaml           # YOLO配置文件
```

## 🔧 已更新的训练脚本

所有4个训练脚本都已更新使用 `data_1029`：

| 脚本 | 状态 | 数据路径 |
|------|------|----------|
| `train_yolo11n.py` | ✅ 已更新 | `/workspace/yolo/data_1029` |
| `train_yolo11s.py` | ✅ 已更新 | `/workspace/yolo/data_1029` |
| `train_yolo11m.py` | ✅ 已更新 | `/workspace/yolo/data_1029` |
| `train_yolov8s.py` | ✅ 已更新 | `/workspace/yolo/data_1029` |

## 🚀 使用方法

### 1. 数据准备（可选，已完成）

如果需要重新准备数据集：

```bash
cd /workspace/yolo
python prepare_data_1029.py
```

**功能：**
- 自动划分训练集和验证集（80%/20%）
- 生成 `data.yaml` 配置文件
- 检查数据质量
- 验证图片和标签是否匹配

### 2. 开始训练

选择一个模型开始训练：

```bash
# 推荐：YOLO11n（最快，适合测试）
python train_yolo11n.py

# YOLO11s（速度和精度平衡）
python train_yolo11s.py

# YOLO11m（精度更高，需要更多GPU内存）
python train_yolo11m.py

# YOLOv8s（经典模型）
python train_yolov8s.py
```

### 3. 训练配置

所有脚本都使用优化后的配置：

```python
CONFIG = {
    'optimizer': 'auto',     # SGD（稳定）
    'lr0': 0.01,             # 学习率
    'batch': 16,             # batch size（11m为8）
    'cos_lr': False,         # 线性学习率
    'patience': 20,          # 早停轮数
    'epochs': 100,           # 最大训练轮数
}
```

## 📈 预期训练效果

基于新数据集（3个类别，158张图片）：

### 训练时间估计
- **YOLO11n**: ~5-10分钟
- **YOLO11s**: ~10-15分钟
- **YOLO11m**: ~15-20分钟
- **YOLOv8s**: ~10-15分钟

### 性能预期
- **mAP50**: 0.90-0.95
- **mAP50-95**: 0.75-0.85
- **训练稳定性**: ✅ 无NaN/INF
- **收敛速度**: 15-30轮

## 🔄 切换数据集

如果需要切换回旧数据集 `/workspace/yolo/data`，需要修改4个训练脚本中的3处路径：

### 需要修改的位置

每个训练脚本（`train_yolo11n.py`, `train_yolo11s.py`, `train_yolo11m.py`, `train_yolov8s.py`）中：

**位置1**: 环境检查函数（约第96行）
```python
# 修改前
data_dir = Path('/workspace/yolo/data_1029')

# 修改后
data_dir = Path('/workspace/yolo/data')
```

**位置2**: 训练函数（约第150行）
```python
# 修改前
data_yaml = '/workspace/yolo/data_1029/data.yaml'

# 修改后
data_yaml = '/workspace/yolo/data/data.yaml'
```

**位置3**: 验证函数（约第277行）
```python
# 修改前
validate_model(str(best_model_path), '/workspace/yolo/data_1029/data.yaml')

# 修改后
validate_model(str(best_model_path), '/workspace/yolo/data/data.yaml')
```

## 📝 数据准备脚本使用说明

### prepare_data_1029.py

**功能：**
1. 自动划分数据集（训练集/验证集）
2. 生成YOLO配置文件
3. 数据质量检查
4. 支持重新分割

**使用方法：**
```bash
python prepare_data_1029.py
```

**交互提示：**
- 如果数据已分割，会询问是否重新分割
- 输入 `y` 重新分割，输入 `n` 跳过

**自定义参数：**

如果需要修改验证集比例，编辑脚本中的参数：

```python
# 默认: 80% 训练集, 20% 验证集
split_dataset(data_dir, val_split=0.2)

# 例如改为 90% 训练集, 10% 验证集
split_dataset(data_dir, val_split=0.1)
```

## 📊 数据质量检查

脚本会自动检查：

✅ **检查项目：**
- 图片和标签数量是否匹配
- 是否存在空标签文件
- 训练集和验证集划分是否合理

⚠️ **常见问题：**

1. **图片和标签不匹配**
   - 某些图片可能没有标注
   - 检查 `images/` 和 `labels/` 目录

2. **空标签文件**
   - 图片中没有检测对象
   - 可以保留（YOLO支持负样本）

## 🎯 训练建议

### 对于小数据集（158张）

1. **数据增强很重要**
   - 已配置的增强策略：
     - 水平翻转（50%）
     - HSV增强
     - Mosaic拼接
     - 随机缩放和平移

2. **避免过拟合**
   - ✅ 使用早停（patience=20）
   - ✅ 监控训练/验证损失差异
   - ✅ 不要训练过多轮次

3. **选择合适的模型**
   - **推荐**: YOLO11n 或 YOLO11s
   - **原因**: 小模型在小数据集上更不容易过拟合

### 训练监控指标

重点关注：
- ✅ `metrics/mAP50-95`: 主要性能指标
- ✅ `val/box_loss`: 验证损失
- ⚠️ 训练损失 vs 验证损失（差距过大 = 过拟合）

## 📚 相关文档

- **训练参数说明**: `/workspace/yolo/md/训练参数修改说明.md`
- **模型效果分析**: `/workspace/yolo/md/模型效果差异分析.md`
- **问题总结**: `/workspace/yolo/md/问题总结.md`

## 🔍 文件检查清单

在开始训练前，确认以下文件存在：

```bash
# 检查数据集结构
ls -la /workspace/yolo/data_1029/
ls -la /workspace/yolo/data_1029/train/images/
ls -la /workspace/yolo/data_1029/train/labels/
ls -la /workspace/yolo/data_1029/val/images/
ls -la /workspace/yolo/data_1029/val/labels/

# 检查配置文件
cat /workspace/yolo/data_1029/data.yaml

# 检查类别文件
cat /workspace/yolo/data_1029/classes.txt
```

## ✅ 快速开始

```bash
# 1. 进入项目目录
cd /workspace/yolo

# 2. 确认数据已准备（已完成）
ls data_1029/train/images/  # 应该有127张图片
ls data_1029/val/images/    # 应该有31张图片

# 3. 开始训练（推荐从最快的模型开始）
python train_yolo11n.py

# 4. 训练完成后查看结果
ls runs/train/yolo11n_bubble/

# 5. 使用训练好的模型进行推理
python inference.py
```

## 📞 问题排查

### 1. 找不到数据文件

**错误**: `❌ 数据配置文件不存在`

**解决**:
```bash
cd /workspace/yolo
python prepare_data_1029.py
```

### 2. GPU内存不足

**错误**: `CUDA out of memory`

**解决**: 修改训练脚本中的 `batch` 参数
```python
'batch': 8,  # 或更小的值 4, 2
```

### 3. 数据集过小警告

**说明**: 158张图片对于深度学习来说较小

**建议**:
- ✅ 使用数据增强（已配置）
- ✅ 使用小模型（YOLO11n/11s）
- ✅ 监控过拟合
- 📈 考虑收集更多数据

---

**配置完成时间**: 2025-10-29  
**数据集**: data_1029 (158张图片，3个类别)  
**状态**: ✅ 准备就绪，可以开始训练

