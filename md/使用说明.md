# YOLO 气泡检测训练说明

## 📁 项目结构

```
yolo/
├── data/                    # 数据集目录
│   ├── images/             # 原始图片
│   ├── labels/             # 标注文件（YOLO格式）
│   ├── classes.txt         # 类别列表
│   └── notes.json          # 数据集信息
├── train.py                # 训练脚本
├── inference.py            # 推理脚本
├── requirements.txt        # 依赖包列表
└── md/                     # 说明文档目录
    └── 使用说明.md
```

## 🚀 快速开始

### 1. 安装依赖

```bash
# 安装所需Python包
pip install -r requirements.txt

# 如果使用GPU，确保已安装CUDA和cuDNN
```

### 2. 训练模型

```bash
# 直接运行训练脚本
python train.py
```

训练脚本会自动执行以下步骤：
- ✅ 自动分割数据集（80%训练集，20%验证集）
- ✅ 创建YOLO配置文件
- ✅ 下载预训练模型
- ✅ 开始训练
- ✅ 保存最佳模型

### 3. 查看训练结果

训练完成后，结果保存在 `runs/train/bubble_detection/` 目录：

```
runs/train/bubble_detection/
├── weights/
│   ├── best.pt          # 最佳模型
│   └── last.pt          # 最后一次训练的模型
├── results.png          # 训练曲线
├── confusion_matrix.png # 混淆矩阵
├── F1_curve.png         # F1曲线
├── P_curve.png          # 精确率曲线
├── R_curve.png          # 召回率曲线
└── PR_curve.png         # PR曲线
```

### 4. 使用模型进行推理

```bash
# 对验证集进行预测
python inference.py
```

预测结果保存在 `runs/predict/results/` 目录。

## ⚙️ 配置参数说明

在 `train.py` 中可以修改以下配置：

```python
CONFIG = {
    'model': 'yolov8n.pt',    # 模型大小
    'epochs': 100,             # 训练轮数
    'batch': 16,              # 批次大小
    'imgsz': 640,             # 图片大小
    'device': 0,              # GPU设备（'cpu' 或 0,1,2...）
    'workers': 8,             # 数据加载线程数
    'patience': 20,           # 早停轮数
    'save_period': 10,        # 保存间隔
    'val_split': 0.2,         # 验证集比例
}
```

### 模型选择

| 模型 | 大小 | 速度 | 精度 | 适用场景 |
|------|------|------|------|----------|
| yolov8n.pt | 最小 | 最快 | 较低 | 实时检测、边缘设备 |
| yolov8s.pt | 小 | 快 | 中等 | 平衡性能 |
| yolov8m.pt | 中 | 中等 | 较高 | 推荐使用 |
| yolov8l.pt | 大 | 慢 | 高 | 高精度需求 |
| yolov8x.pt | 最大 | 最慢 | 最高 | 最高精度 |

## 📊 数据集信息

- **类别数量**: 1 (bubble)
- **图片数量**: 65张
- **标注格式**: YOLO格式（归一化坐标）
- **数据来源**: Label Studio

## 🔧 高级用法

### 自定义训练参数

```bash
# 修改train.py中的CONFIG字典
# 例如：增加训练轮数、修改批次大小等
```

### 使用自己的图片进行推理

```python
from ultralytics import YOLO

# 加载模型
model = YOLO('runs/train/bubble_detection/weights/best.pt')

# 预测单张图片
results = model.predict('path/to/image.jpg', save=True)

# 预测多张图片
results = model.predict('path/to/images/', save=True)

# 预测视频
results = model.predict('path/to/video.mp4', save=True)
```

### 导出模型到其他格式

```python
from ultralytics import YOLO

model = YOLO('runs/train/bubble_detection/weights/best.pt')

# 导出为ONNX格式
model.export(format='onnx')

# 导出为TensorRT格式
model.export(format='engine')

# 导出为CoreML格式（iOS）
model.export(format='coreml')
```

## 📝 注意事项

1. **GPU内存不足**：减小 `batch` 值或使用更小的模型
2. **训练时间过长**：减少 `epochs` 或使用更小的模型
3. **精度不够**：尝试以下方法：
   - 使用更大的模型（如 yolov8m.pt）
   - 增加训练轮数
   - 增加数据集大小
   - 调整数据增强参数

4. **数据集较小**：当前只有65张图片，建议：
   - 收集更多数据
   - 使用数据增强
   - 适当降低模型复杂度

## 🎯 性能指标说明

- **mAP50**: IoU阈值为0.5时的平均精度
- **mAP50-95**: IoU阈值从0.5到0.95的平均精度
- **Precision**: 精确率（预测为正例中真正例的比例）
- **Recall**: 召回率（实际正例中被正确预测的比例）

## 🐛 常见问题

### Q: 提示找不到ultralytics模块
A: 运行 `pip install ultralytics`

### Q: CUDA out of memory
A: 减小batch size，如改为8或4

### Q: 训练速度很慢
A: 检查是否使用GPU（device=0），或减小图片大小（imgsz=416）

### Q: 如何恢复训练
A: 设置 `resume=True` 并指定checkpoint路径

## 📚 参考资料

- [Ultralytics YOLOv8 官方文档](https://docs.ultralytics.com/)
- [YOLO训练技巧](https://docs.ultralytics.com/yolov5/tutorials/tips_for_best_training_results/)

