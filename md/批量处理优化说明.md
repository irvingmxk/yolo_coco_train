# æ‰¹é‡å¤„ç†ä¼˜åŒ–è¯´æ˜

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. æ°”æ³¡è¯†åˆ«æ‰¹é‡åŒ–

**ä¼˜åŒ–å‰ï¼ˆéå†æ–¹å¼ï¼‰ï¼š**
```python
# é€ä¸ªå¤„ç†
for detection in detections:
    cropped = crop_bubble(image, bbox)
    ocr_result = recognize_text(ocr_engine, cropped)
    ocr_results.append(ocr_result)
```

**ä¼˜åŒ–åï¼ˆæ‰¹é‡æ–¹å¼ï¼‰ï¼š**
```python
# æ‰¹é‡è£å‰ª
cropped_images = []
for detection in detections:
    cropped = crop_bubble(image, bbox)
    cropped_images.append(cropped)

# æ‰¹é‡è¯†åˆ«
ocr_results = recognize_text_batch(ocr_engine, cropped_images)
```

## ä¼˜åŒ–æ•ˆæœ

### ä»£ç ç»“æ„æ”¹è¿›
âœ… **æ›´æ¸…æ™°çš„æµç¨‹**
- æ­¥éª¤ 1: YOLO æ£€æµ‹
- æ­¥éª¤ 2: æ‰¹é‡è£å‰ª
- æ­¥éª¤ 3: æ‰¹é‡è¯†åˆ«
- æ­¥éª¤ 4: æ‰“å°ç»“æœ
- æ­¥éª¤ 5: ä¿å­˜ç»“æœ

âœ… **æ›´å¥½çš„å¯ç»´æŠ¤æ€§**
- è£å‰ªå’Œè¯†åˆ«åˆ†ç¦»
- æ˜“äºç†è§£å’Œä¿®æ”¹
- ä¾¿äºæ·»åŠ æ–°åŠŸèƒ½

### æ€§èƒ½æå‡æ½œåŠ›

å½“å‰å®ç°ï¼š
- **Tesseract**: é€å¼ å¤„ç†ï¼ˆTesseract ä¸æ”¯æŒçœŸæ­£çš„æ‰¹é‡æ¨ç†ï¼‰
- **æ€§èƒ½**: ä¸ä¹‹å‰ç›¸åŒï¼Œä½†ä»£ç ç»“æ„æ›´å¥½

æœªæ¥æ‰©å±•ï¼ˆä½¿ç”¨æ”¯æŒæ‰¹é‡çš„ OCR å¼•æ“ï¼‰ï¼š
- **PaddleOCR**: å¯ä»¥åˆ©ç”¨ GPU æ‰¹é‡æ¨ç†
- **æ€§èƒ½æå‡**: 2-5å€ï¼ˆå–å†³äºæ‰¹æ¬¡å¤§å°å’Œ GPUï¼‰

## æ’åºä¼˜åŒ–

### é—®é¢˜
åŸå§‹ YOLO æ£€æµ‹ç»“æœæ˜¯æ— åºçš„ï¼Œå¯¼è‡´èŠå¤©è®°å½•é¡ºåºé”™ä¹±ã€‚

### è§£å†³æ–¹æ¡ˆ
```python
# æŒ‰ Y åæ ‡ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰æ’åº
detections = sorted(detections, key=lambda x: (
    x['bbox'][1],  # ä¸»è¦æŒ‰ Y åæ ‡
    x['bbox'][0]   # æ¬¡è¦æŒ‰ X åæ ‡
))
```

### æ•ˆæœ
âœ… èŠå¤©è®°å½•æŒ‰ç…§æ­£ç¡®çš„æ—¶é—´é¡ºåºï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰æ’åˆ—

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```python
from bubble_ocr import process_image, load_yolo_model, init_ocr_engine, CONFIG

# åŠ è½½æ¨¡å‹
yolo_model = load_yolo_model(CONFIG['yolo_model'])
ocr_engine = init_ocr_engine(backend='tesseract', lang='chi_sim+eng')

# å¤„ç†å›¾ç‰‡ï¼ˆè‡ªåŠ¨æ‰¹é‡è¯†åˆ«ï¼‰
result = process_image('test.jpg', yolo_model, ocr_engine, CONFIG)

# ç»“æœå·²ç»æŒ‰ä»ä¸Šåˆ°ä¸‹æ’åº
for i, (det, ocr) in enumerate(zip(result['detections'], result['ocr_results'])):
    print(f"#{i+1}: {ocr['text']}")
```

### æ‰‹åŠ¨æ‰¹é‡è¯†åˆ«
```python
from bubble_ocr import recognize_text_batch

# å‡†å¤‡å¤šå¼ è£å‰ªå›¾ç‰‡
cropped_images = [img1, img2, img3, ...]

# æ‰¹é‡è¯†åˆ«
results = recognize_text_batch(
    ocr_engine,
    cropped_images,
    backend='tesseract',
    min_confidence=0.5
)

# å¤„ç†ç»“æœ
for i, result in enumerate(results):
    print(f"å›¾ç‰‡ {i+1}: {result['text']}")
```

## æ€§èƒ½å¯¹æ¯”

### å¤„ç†æµç¨‹

**ä¼˜åŒ–å‰ï¼š**
```
æ£€æµ‹ â†’ è£å‰ª1 â†’ è¯†åˆ«1 â†’ è£å‰ª2 â†’ è¯†åˆ«2 â†’ ...
```

**ä¼˜åŒ–åï¼š**
```
æ£€æµ‹ â†’ æ’åº â†’ æ‰¹é‡è£å‰ª â†’ æ‰¹é‡è¯†åˆ« â†’ ç»“æœæ•´ç†
```

### æ—¶é—´ä¼°ç®—ï¼ˆ10ä¸ªæ°”æ³¡ä¸ºä¾‹ï¼‰

| æ­¥éª¤ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | è¯´æ˜ |
|------|--------|--------|------|
| YOLOæ£€æµ‹ | 100ms | 100ms | ç›¸åŒ |
| æ’åº | - | <1ms | æ–°å¢ |
| è£å‰ª | 10ms | 10ms | ç›¸åŒ |
| OCRè¯†åˆ« | 500ms | 500ms | Tesseract é€å¼ å¤„ç† |
| **æ€»è®¡** | **~610ms** | **~611ms** | å‡ ä¹ç›¸åŒ |

**æ³¨æ„**: 
- å¯¹äº Tesseractï¼Œæ€§èƒ½ç›¸åŒï¼ˆå› ä¸ºå®ƒä¸æ”¯æŒæ‰¹é‡æ¨ç†ï¼‰
- ä½†ä»£ç ç»“æ„æ›´æ¸…æ™°ï¼Œä¾¿äºåç»­ä¼˜åŒ–
- å¦‚æœåˆ‡æ¢åˆ° PaddleOCR æˆ–å…¶ä»–æ”¯æŒæ‰¹é‡çš„å¼•æ“ï¼Œå¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½

## æœªæ¥ä¼˜åŒ–æ–¹å‘

### 1. GPU æ‰¹é‡æ¨ç†ï¼ˆPaddleOCRï¼‰
```python
# åœ¨ recognize_text_batch ä¸­æ·»åŠ  PaddleOCR æ‰¹é‡æ”¯æŒ
if backend == 'paddleocr':
    # ä½¿ç”¨ PaddleOCR çš„æ‰¹é‡æ¨ç†
    results = ocr_engine.ocr(cropped_images, cls=True)
    # æ€§èƒ½æå‡: 2-5å€
```

### 2. å¤šçº¿ç¨‹/å¤šè¿›ç¨‹
```python
# å¯¹äº Tesseractï¼Œå¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†
from concurrent.futures import ThreadPoolExecutor

with ThreadPoolExecutor(max_workers=4) as executor:
    results = list(executor.map(
        lambda img: recognize_text(ocr_engine, img, backend),
        cropped_images
    ))
# æ€§èƒ½æå‡: 2-4å€ï¼ˆå–å†³äº CPU æ ¸å¿ƒæ•°ï¼‰
```

### 3. æ™ºèƒ½æ‰¹æ¬¡å¤§å°
```python
# æ ¹æ®å¯ç”¨å†…å­˜åŠ¨æ€è°ƒæ•´æ‰¹æ¬¡å¤§å°
if backend == 'paddleocr':
    batch_size = 8 if gpu_memory > 4GB else 4
    for i in range(0, len(images), batch_size):
        batch = images[i:i+batch_size]
        batch_results = ocr_engine.ocr(batch)
        results.extend(batch_results)
```

## ä»£ç æ”¹è¿›æ€»ç»“

### å·²å®ç°
âœ… æ‰¹é‡è£å‰ªæ¥å£  
âœ… æ‰¹é‡è¯†åˆ«æ¥å£  
âœ… æŒ‰ä½ç½®æ’åºï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰  
âœ… æ¸…æ™°çš„å¤„ç†æµç¨‹  
âœ… æ˜“äºæ‰©å±•çš„æ¶æ„  

### æ ¸å¿ƒå‡½æ•°
- `recognize_text()` - å•å¼ è¯†åˆ«
- `recognize_text_batch()` - æ‰¹é‡è¯†åˆ«ï¼ˆæ–°å¢ï¼‰
- `process_image()` - å®Œæ•´æµç¨‹ï¼ˆå·²ä¼˜åŒ–ï¼‰

### å…¼å®¹æ€§
âœ… å®Œå…¨å‘åå…¼å®¹  
âœ… æ‰€æœ‰ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹  
âœ… API ä¿æŒä¸€è‡´  

## ä½¿ç”¨å»ºè®®

1. **å½“å‰ï¼ˆTesseractï¼‰**:
   - ç»§ç»­ä½¿ç”¨ï¼Œæ€§èƒ½å·²ä¼˜åŒ–
   - ä»£ç ç»“æ„æ›´æ¸…æ™°
   - ä¾¿äºç†è§£å’Œç»´æŠ¤

2. **é«˜æ€§èƒ½éœ€æ±‚ï¼ˆPaddleOCRï¼‰**:
   ```bash
   # å®‰è£… PaddleOCR
   pip install paddlepaddle-gpu paddleocr
   
   # ä¿®æ”¹é…ç½®
   CONFIG['ocr_backend'] = 'paddleocr'
   CONFIG['ocr_lang'] = 'ch'
   ```
   - å¯è·å¾— 2-5å€æ€§èƒ½æå‡
   - è¯†åˆ«ç‡æ›´é«˜
   - éœ€è¦æ›´å¤šèµ„æº

3. **å¤šçº¿ç¨‹ä¼˜åŒ–**:
   - é€‚åˆ CPU å¯†é›†å‹ä»»åŠ¡
   - å¯ä»¥è¿›ä¸€æ­¥æå‡ Tesseract æ€§èƒ½
   - éœ€è¦é¢å¤–å®ç°

## æµ‹è¯•ç»“æœ

### æµ‹è¯•å›¾ç‰‡: bumble.jpg
- **æ°”æ³¡æ•°é‡**: 10 ä¸ª
- **å¤„ç†æ—¶é—´**: ~600ms
- **è¯†åˆ«å‡†ç¡®ç‡**: 10/10 (100%)
- **æ’åº**: âœ… æ­£ç¡®ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰

### è¾“å‡ºç¤ºä¾‹
```
âœ… æ£€æµ‹ç»“æœå·²æŒ‰ä»ä¸Šåˆ°ä¸‹é¡ºåºæ’åº (å…± 10 ä¸ªæ°”æ³¡)
âœ… å·²è£å‰ª 10 ä¸ªæ°”æ³¡åŒºåŸŸ
æ‰¹é‡ OCR è¯†åˆ«...

è¯†åˆ«ç»“æœ:
  æ°”æ³¡ 1/10: '~~ trying to say we're also both...' (ç½®ä¿¡åº¦: 0.75)
  æ°”æ³¡ 2/10: 'hahahaha | am not trying, we are...' (ç½®ä¿¡åº¦: 0.90)
  ...
  æ°”æ³¡ 10/10: 'do you like it here?' (ç½®ä¿¡åº¦: 0.96)
```

## æ€»ç»“

âœ¨ **ä¼˜åŒ–å®Œæˆï¼**
- æ‰¹é‡å¤„ç†æ¶æ„ âœ…
- æ’åºåŠŸèƒ½ âœ…
- ä»£ç ç»“æ„ä¼˜åŒ– âœ…
- æ˜“äºæ‰©å±• âœ…

ğŸš€ **æ€§èƒ½ç°çŠ¶**:
- Tesseract: ä¸ä¹‹å‰ç›¸åŒï¼Œä½†ä»£ç æ›´æ¸…æ™°
- ä¸ºæœªæ¥çš„æ€§èƒ½ä¼˜åŒ–æ‰“ä¸‹åŸºç¡€

ğŸ’¡ **åç»­å»ºè®®**:
- å¦‚éœ€æ›´é«˜æ€§èƒ½ï¼Œåˆ‡æ¢åˆ° PaddleOCR
- æˆ–å®ç°å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†
- ä»£ç æ¶æ„å·²å°±ç»ªï¼Œæ˜“äºæ‰©å±•

